<script type='text/javascript'>
// function parseXML(xmlString) {
//   //just one approach, time will tell if another one will be implemented
//   var wrapper= document.createElement('div');
//   wrapper.innerHTML= xmlString;
//   var div= wrapper.firstChild;
//   var fragment = document.createDocumentFragment();
//   Array.from(wrapper.childNodes).forEach((node)=>{
//     console.log(node);
//     fragment.appendChild(node);
//   })

//   return fragment;
// }
function executeScriptTags(scripts) {
  scripts.forEach( function(scriptText){
    var head = document.getElementsByTagName("head")[0] ||
              document.documentElement,
    script = document.createElement("script");

    script.type = "text/javascript";
    try {
      script.appendChild(document.createTextNode(scriptText));      
    } catch(e) {
      script.text = scriptText;
    }
    head.insertBefore(script, head.firstChild);
    head.removeChild(script);
  });
}

function initializeRoutes(){
  console.log('DomContentLoaded');
  window.history.pushState({'_spa_PATH':'/'},'','/');
  dispatchEvent(new PopStateEvent('popstate',{state:{'_spa_PATH':'/'}}));
}

function getScriptsContentInDoc(innerHTML){
  var scriptContentRE = /<script\b[^>]*>([\s\S]*?)<\/script>/gm;

  var match;
  var scripts = [];
  while (match = scriptContentRE.exec(innerHTML)) {
    scripts.push(match[1]);
  }
  return scripts;
}

function handlePopChange (event, routeComponents) {
      // console.log('HandleStateChange function invoked', event)
  console.trace();
  console.log(event,routeComponents)

  if ( event.state && event.state._spa_PATH ) {

    let pathname = event.state._spa_PATH;
    for ( var i = 0; i < routeComponents.length; i++ ) {

      routeComponent = routeComponents[i];
      if ( routeComponent.path === pathname ) {
        routeComponent.render.call(routeComponent);
      } else {
        if ( routeComponent.innerHTML ) {
          //implementation subject to change
          routeComponent.shadowRoot.innerHTML = '';
        }
      }
    }
  }
}

function handleListenerBound ( handleChangeListener, ...args ) {
  return ( ...eventArgs ) => {
    // console.trace();
    console.log ( eventArgs, args );
    handleChangeListener.call(this, ...eventArgs, ...args );
  }
}

function preCacheRoutes (e, preCachedComponents) {
  (preCachedComponents.reduce( ( chain, elem )=>{
    return chain.then((data) => {
      // console.log(data);
      return fetch(elem.getFileSrc())
    })
  }, Promise.resolve())).catch(err=>console.log(err));
}

</script>