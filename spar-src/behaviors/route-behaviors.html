<link rel='import' href='../helper-functions.html'>
<script>

window.addEventListener('load',initializeRoutes);


var routeBehaviours = function(superClass) {
  var _routeComponents = [];
  window.addEventListener('popstate', handleListenerBound(handlePopChange, _routeComponents));
  return class extends superClass {
    
    connectedCallback() {

      preCacheRoute(this);
      //assume that each component is instantiated in order of DOM tree
      _routeComponents.push(this);
      //console.log(_routeComponents);
    }
    get pathParsed() {
      var anchor = document.createElement('a');
      anchor.href = this.path;
      return anchor.pathname;
    }
    render() {
      var context = this;
      //console.log('fetching',context.src);
      //need to fix so as to not need window.location

      fetch(`${window.location.origin}/${context.src}`)
        .then(function(res) {
          // console.log(res);
          return res.text();
        })
        .then(function(data) {
          clearShadowDOM(context);
          fillShadowDOM(context,data);
        // var scriptTags = getScriptTags( data );
        // if(scriptTags){
        //   executeScriptTags(scriptTags); 
        // }
        //console.trace();
        })
        .catch(function error(err){
          console.log(err);
        })
        //console.trace()
    }
        
  // Will implement with data-binding functionality when needed
  // injectBoundHTML: function injectBoundHTML(html, element) {
  //   var template = document.createElement('template', 'dom-bind');
  //   var doc = template.content.ownerDocument;
  //   var div = doc.createElement('div');
  //   div.innerHTML = html;
  //   template.content.appendChild(div);
  //   while (element.firstChild) {
  //       element.removeChild(element.firstChild);
  //   }
  //   element.appendChild(Polymer.Base.instanceTemplate(template));
  // },
  // isLoaded: function() {
  //   return 
  // },
  }
}
var RouteBehaviours = routeBehaviours(HTMLElement);

</script>